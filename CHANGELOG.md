# Changelog

## [1.7.0] — 2026-02-18 — Hardening & Offline

### Security
- **Removed `exec` tool** (`src/tools/exec.ts` deleted) — direct host command execution is no longer possible. All sandboxed execution now goes through `runSandboxed` (Docker).

### State Management
- **Sub-agent state persisted to SQLite** — `spawnLog`, `runningMap`, and `namedSessions` in-memory structures replaced by a new `subagents` table with full CRUD. Sub-agent history and named session resolution (`@AgentName:`) now survive process restarts.
- **`vector_memories` table added** to SQLite for local embedding storage (Float32 blobs).
- Schema bumped to version 2 with backward-compatible migration.

### Dashboard
- **Real-time SSE** (`GET /api/events`) replaces the 30-second polling loop. Memory updates arrive every 5 s; spawn status changes arrive instantly.
- Client-side ring buffer maintains 120 memory samples for the live RAM sparkline.
- Spawn list updates individual rows in-place on SSE events without a full fetch.
- Heartbeat every 30 s triggers a lightweight refresh of usage, skills, and tasks panels.

### Memory
- **Local vector memory provider** — pure-JS cosine similarity on `Float32Array` embeddings generated by Ollama (`nomic-embed-text` default). Enabled via `config.embeddings.enabled = true`.
- **Supermemory is now optional** — `config.supermemory.apiKey` is no longer required. Falls back gracefully to local embeddings → stub SQLite keyword search.
- New factory `createMemoryProvider(config)` auto-selects the best available backend.
- Supermemory filter prompt setup moved out of `index.ts` into the provider's `setupCloudFilter()` method.

### Config
- Added `config.embeddings` block: `enabled`, `ollamaUrl`, `model`, `maxMemories`.
- `config.supermemory.apiKey` is now optional (no longer required on startup).

### Infrastructure
- New `src/events.ts` event bus — lightweight `subscribe`/`emit` for SSE without circular deps.
- `src/metrics.ts` emits `memory` events on each sample so SSE clients get live RAM updates.
- `src/tools/subagent.ts` emits `spawn` events on status changes for real-time dashboard updates.

## [1.6.0] — 2026-02-17 — Autonomy & Live Monitoring

### Features
- RAM auto-clean: hourly `dbMessages.cleanup(90)` + SQLite `VACUUM`.
- Sub-agent live status in dashboard with kill button.
- Skill Shop safe score (0–100) with weighted pattern analysis.
- Smarter 2-tier router: weighted keywords + message length + connector phrases.
- Natural language recurring reminders (`parseNaturalSchedule`).
- Live RAM graph in dashboard with SVG sparkline.
- Docker sandbox (`runSandboxed`) for isolated code execution.
- Local Ollama fast-tier support.
- Named sub-agent chat via `@AgentName:` prefix.

## [1.5.0] — 2026-02-16 — Sub-Agent Hardening

### Features
- Sub-agent memory isolation (no conversation history pollution).
- Dashboard spawn activity panel.
- Skill Shop proactive weekly discovery (seeded recurring task).
- `KODA_GITHUB_TOKEN` support for higher GitHub API rate limits.
- `config.subagent` block: externalized `timeoutMs` and `maxSteps`.

## [1.4.0] — 2026-02-15 — Sub-Agents & Smart Skill Shop

### Features
- Sub-agent spawning (`spawnAgent` tool) with parallel execution.
- Smart Skill Shop: search, preview, and install `SKILL.md` files from skills.sh/GitHub.
- Web dashboard (read-only HTML, Bun-served).
- 2-tier LLM routing (fast: Gemini Flash, deep: Claude Sonnet).
- Exa search updated: highlights for webSearch, full text for extractUrl.
- Removed Cartesia TTS.
